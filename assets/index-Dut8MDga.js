import{r as i,j as R}from"./iframe-mkfPu5JP.js";function C(e,n,{edges:t=["leading","trailing"]}={}){let r,s=null;const u=t!=null&&t.includes("leading"),a=t==null||t.includes("trailing"),o=()=>{s!==null&&(e.apply(r,s),r=void 0,s=null)},l=()=>{a&&o(),m()};let c=null;const f=()=>{c!=null&&clearTimeout(c),c=setTimeout(()=>{c=null,l()},n)},g=()=>{c!==null&&(clearTimeout(c),c=null)},m=()=>{g(),r=void 0,s=null},v=function(...y){r=this,s=y;const E=c==null;f(),u&&E&&o()};return v.cancel=m,v}function d(e){const n=i.useRef(e);return i.useEffect(()=>{n.current=e},[e]),i.useCallback((...t)=>n.current(...t),[])}function h({onChange:e,timeThreshold:n,leading:t=!1,trailing:r=!0}){const s=d(e),u=i.useRef({value:!1,clearPreviousDebounce:()=>{}});i.useEffect(()=>{const o=u.current;return()=>{o.clearPreviousDebounce()}},[]);const a=i.useMemo(()=>{const o=[];return t&&o.push("leading"),r&&o.push("trailing"),o},[t,r]);return i.useCallback(o=>{if(o===u.current.value)return;const l=C(()=>{s(o),u.current.value=o},n,{edges:a});u.current.clearPreviousDebounce(),l(),u.current.clearPreviousDebounce=l.cancel},[s,n,a])}function M(e,n){const t=d(e),r=i.useRef(()=>{});return i.useCallback(u=>{if(r.current(),r.current=()=>{},u==null)return;const a=t(u);typeof a=="function"&&(r.current=a)},[t,...n])}function k(e,n){const t=d(e),r=i.useMemo(()=>{if(!(typeof IntersectionObserver>"u"))return new IntersectionObserver(([s])=>{t(s)},n)},[t,n]);return M(s=>(r?.observe(s),()=>{r?.unobserve(s)}),[t,n])}function w(e,n={}){const t=i.useCallback(()=>{e(document.visibilityState)},[e]);i.useEffect(()=>((n?.immediate??!1)&&t(),document.addEventListener("visibilitychange",t),()=>{document.removeEventListener("visibilitychange",t)}),[t,n?.immediate])}function T({onImpressionStart:e=()=>{},onImpressionEnd:n=()=>{},rootMargin:t,areaThreshold:r=0,timeThreshold:s=0}){const u=d(e),a=d(n),o=i.useRef(!1),l=h({timeThreshold:s,onChange:c=>{(c?u:a)()},leading:!0});return w(c=>{o.current&&l(c==="visible")}),k(c=>{if(document.visibilityState==="hidden")return;const f=c.intersectionRatio,g=r===0?c.isIntersecting:f>=r;o.current=g,l(g)},{rootMargin:t,threshold:r})}function j(...e){return n=>{for(const t of e)if(t!=null){if(typeof t=="function"){t(n);continue}t.current=n}}}var A=i.forwardRef(D);function D({as:e,rootMargin:n,areaThreshold:t,timeThreshold:r,onImpressionStart:s,onImpressionEnd:u,...a},o){const l=e??"div",c=T({onImpressionStart:s,onImpressionEnd:u,areaThreshold:t,timeThreshold:r,rootMargin:n});return R.jsx(l,{ref:j(o,c),...a})}Object.assign(A,{displayName:"ImpressionArea"});function K({value:e,defaultValue:n,onChange:t,equalityFn:r=Object.is}){const[s,u]=i.useState(n),a=e!==void 0,o=a?e:s,l=i.useCallback(c=>{const f=L(c)?c(o):c;r(o,f)!==!0&&(a===!1&&u(f),a===!0&&f===void 0&&u(f),t?.(f))},[a,t,r,o]);return[o,l]}function L(e){return typeof e=="function"}function _(){const[e,n]=i.useState(!1),t=O(),r=i.useCallback(async s=>{try{return n(!0),await s}finally{t.isMounted&&n(!1)}},[t.isMounted]);return i.useMemo(()=>[e,r],[e,r])}function O(){const e=i.useRef({isMounted:!0}).current;return i.useEffect(()=>(e.isMounted=!0,()=>{e.isMounted=!1}),[e]),e}var p=class{storage=new Map;get(e){return this.storage.get(e)??null}set(e,n){this.storage.set(e,n)}remove(e){this.storage.delete(e)}clear(){this.storage.clear()}},b=class{static canUse(){const e=I();try{return localStorage.setItem(e,"test"),localStorage.removeItem(e),!0}catch{return!1}}get(e){return localStorage.getItem(e)}set(e,n){localStorage.setItem(e,n)}remove(e){localStorage.removeItem(e)}clear(){localStorage.clear()}},S=class{static canUse(){const e=I();try{return sessionStorage.setItem(e,"test"),sessionStorage.removeItem(e),!0}catch{return!1}}get(e){return sessionStorage.getItem(e)}set(e,n){sessionStorage.setItem(e,n)}remove(e){sessionStorage.removeItem(e)}clear(){sessionStorage.clear()}};function I(){return new Array(4).fill(null).map(()=>Math.random().toString(36).slice(2)).join("")}function U(){return b.canUse()?new b:new p}function P(){return S.canUse()?new S:new p}U();P();export{_ as a,K as u};
